{% extends "app/base.html"%} {% load static %} {% block product-detail %}
<style>
  .img-detail {
    max-height: 340px;
    max-width: 340px;
  }
  .price {
    margin: 0;
  }
  .chg-quantity {
    margin: 0;
  }
</style>
<div class="container container-detail">
  <div class="row no-gutters">
    <div class="col-12 py-3"><h3>Chi tiết sản phẩm</h3></div>
    <div class="col-12">
      <div class="card mb-3">
        <div class="row no-gutters">
          <div
            class="col-md-4 d-flex align-items-center justify-content-center"
          >
            <img class="img-detail" src="{{ product.ImageURL }}" />
          </div>
          <div class="col-md-8">
            <div class="card-body">
              <h5 class="card-title font-weight-bold pt-3">{{product.name}}</h5>
              <p class="card-text">{{product.detail}}</p>
              <p class="card-text font-weight-bold">Thành phần:</p>
              <p class="card-text">{{product.detail_ingredient}}</p>
            </div>
            <div
              class="card-body d-flex justify-content-between align-items-center"
            >
              <p class="price font-weight-bold">
                ${{ product.price | floatformat:2 }}
              </p>
              <div class="input-group" style="max-width: 20%">
                <span class="input-group-btn">
                  <button
                    type="button"
                    class="btn btn-outline-secondary chg-quantity"
                    data-action="removeitem"
                    data-product="{{ product.id }}"
                  >
                    -
                  </button>
                </span>
                <input
                  type="number"
                  class="form-control quantity-input"
                  value="1"
                />
                <span class="input-group-btn">
                  <button
                    type="button"
                    class="btn btn-outline-secondary chg-quantity"
                    data-action="additem"
                    data-product="{{ product.id }}"
                  >
                    +
                  </button>
                </span>
              </div>
              <a
                data-product="{{product.id}}"
                data-action="add-to-cart"
                class="btn btn-outline-dark update-cart"
                style="float: right"
                >Thêm vào giỏ</a
              >
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".update-cart").forEach(function (button) {
      button.addEventListener("click", function () {
        var productId = this.getAttribute("data-product");
        var action = this.getAttribute("data-action");

        fetch("{% url 'update_item_detail' %}", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": "{{ csrf_token }}",
          },
          body: JSON.stringify({
            productId: productId,
            action: action,
          }),
        })
          .then(function (response) {
            return response.json();
          })
          .then(function (data) {
            console.log(data.cart_items);
            console.log(data.total_quantity);
          })
          .catch(function (error) {
            console.error(error);
          });
      });
    });
  });
</script>

{% endblock product-detail %}
